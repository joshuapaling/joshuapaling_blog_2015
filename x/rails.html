
<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
  <title>Joshua Paling </title>
  <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />
  <link href="../stylesheets/application-650b1803.css" rel="stylesheet" />
  <script src="../javascripts/application-8d565278.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
</head>
<body>
  <div class="page-wrapper">
    <header>
      <h1>Joshua Paling</h1>
      <nav>
        <a class="" href="/">Blog</a>
        <a class="" href="/about.html">About</a>
        <a class="" href="/resume.html">Resume</a>
        <a href="../feed.xml">RSS</a>
        <a target="_blank" href="https://twitter.com/joshuapaling">@joshuapaling</a>
      </nav>
    </header>


<h1>Rails</h1>

<h2>Models</h2>

<pre><code class="language-ruby">class User &lt; ActiveRecord::Base
  has_many :tasks
end

class Task &lt; ActiveRecord::Base
  belongs_to :user
  default_scope { order(sort_order: :asc) }
  scope :published, -&gt; { where(published: true) }
end
</code></pre>

<p>using models:</p>

<pre><code class="language-ruby">
User.find(id)
User.where(email: 'joss@bbl.com').first
</code></pre>

<pre><code class="language-ruby"># bypasses callbacks and validation
Model.update_columns(column: 'Value')

# does not bypass validation
Model.update_attributes(:field1 =&gt; "value", :field2 =&gt; "value2", :field3 =&gt; "value3")
</code></pre>

<h2>Migrations</h2>

<p>In mySQL, with certain settings, Text cols can't have a default value. So they must allow null and have default value set to false. Example migration converting varchar to text:</p>

<pre><code class="language-ruby">change_column :employees, :asset_return_details, :text, null: true, default: nil
</code></pre>

<p>Create new table including fkey to courses table.</p>

<pre><code class="language-bash">./bin/rails g model Post category:references col:string col:integer
# all col types:
# :primary_key, :string, :text,
# :integer, :float, :decimal, :datetime, :timestamp,
# :time, :date, :binary, :boolean, :references
</code></pre>

<p>example decimal migration, with precision and scale:</p>

<pre><code class="language-ruby"># more at https://ariejan.net/2012/08/28/rails-migrations-decimal-precision-and-scale/
# allows up to 999.99
change_column :my_table, :my_col, :decimal, precision: 5, scale: 2

# change col to be null - http://api.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/SchemaStatements.html#method-i-change_column_null
change_column_null :employee_sites, :employee_site_role_id, false
</code></pre>

<p><a href="http://stackoverflow.com/questions/4384284/rails-generate-model-fieldtype-what-are-the-options-for-fieldtype">All options for  field:type</a></p>

<pre><code>def change
  create_table :workout_substitutions do |t|
    t.references :user, index: true, foreign_key: true
    t.timestamps null: false
  end

  # Add unique index:
  add_index(:accounts, [:branch_id, :party_id], unique: true)
end
</code></pre>

<p>To add a fkey column to an existing table: see <a href="https://stackoverflow.com/a/42056089/1373987">here</a></p>

<p>migration only, no model generation:</p>

<pre><code class="language-ruby">rails g migration drop_posts
</code></pre>

<p>and in the migration:</p>

<pre><code class="language-ruby">drop_table :posts
remove_column :table_name, :column_name
rename_column :table_name, :old_column, :new_column
add_column :table_name, :column_name, :type, null: false, default: ''

add_reference(:products, :user, foreign_key: true) # creates user_id col, with proper fkey index

remove_reference :tasks, :employee, index: true, foreign_key: true
</code></pre>

<p>More <a href="http://edgeapi.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/SchemaStatements.html#method-i-add_reference">here</a></p>

<p>run it / roll back:</p>

<pre><code class="language-markup">rake db:migrate
rake db:rollback RAILS_ENV=test
</code></pre>

<h2>Views</h2>

<pre><code class="language-ruby"># render _my_partial.html.erb
&lt;%= render 'my_partial', my_var: my_var %&gt;
</code></pre>

<p>Image url in rails with sprockets:</p>

<pre><code class="language-scss">background: transparent image-url('asterix.png') no-repeat center center;
</code></pre>

<h2>Misc</h2>

<pre><code class="language-ruby">Post.all.to_json # returns a string
Post.all.as_json # returns an array of hashes
Posts.all.to_json == Post.all.as_json.to_json # true - they are the same.
</code></pre>

<pre><code class="language-ruby">if Rails.env.development?
</code></pre>

<pre><code class="language-ruby"># relative path to file
redis_config_path = File.expand_path("../../../../app/Config/redis_database_numbers.json", __FILE__)
</code></pre>

<h2>When to restart rails server</h2>

<p>The general rule of thumb here is making changes to anything outside of app/ or config/routes.rb will require a restart. <a href="http://stackoverflow.com/questions/17729345/when-do-i-need-to-restart-server-in-rails">more</a></p>

<h2>View Rails site from other device over local network:</h2>

<pre><code>rails server -b 0.0.0.0
</code></pre>

<p>Then access it via your local IP, eg: <code>http://169.254.90.15:3000/</code> (Which you can find in System preferences -&gt; network) or your bonjour address, eg <code>http://joshuas-mbp:3000/</code> or <code>http://joshuas-macbook-pro.local:3000/</code></p>

<p>(as per <a href="http://stackoverflow.com/a/28948293/1373987">this answer</a>)</p>

<h3 id="thing">&amp;:thing</h3>

<p>Example:</p>

<pre><code class="language-ruby">def tag_names
  @tag_names || tags.map(&amp;:name).join(' ')
end
</code></pre>

<p><a href="http://stackoverflow.com/questions/1217088/what-does-mapname-mean-in-ruby">More info</a></p>

<h3 id="rails-logger">Rails logger</h3>

<pre><code class="language-ruby">Rails.logger.info('Cookies: ' + cookies.count.to_s)
</code></pre>

<h3 id="routes">Routes</h3>

<p>Additional routes on same controller</p>

<pre><code class="language-ruby">resources :territory_masters, only: [:index, :update] do
  collection do
    get 'search'
  end

  member do
    get 'edit_employee'
    put 'update_employee'
    delete 'delete_employee'
  end
end
</code></pre>


    <!-- Footer -->
    <footer>
      <nav>
        <a class="" href="/">Blog</a>
        &nbsp;&bull;&nbsp;
        <a class="" href="/about.html">About</a>
        &nbsp;&bull;&nbsp;
        <a class="" href="/resume.html">Resume</a>
        &nbsp;&bull;&nbsp;
        <a href="../feed.xml">RSS</a>
        &nbsp;&bull;&nbsp;
        <a class="" href="/archives.html">Archives</a>
      </nav>
      <div class="row">
        <div class="col-lg-12">
          <p>Copyright &copy; Joshua Paling 2015</p>
        </div>
      </div>
      <!-- /.row -->
    </footer>

  </div>

</body>
</html>

