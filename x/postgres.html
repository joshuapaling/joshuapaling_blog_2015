
<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
  <title>Joshua Paling </title>
  <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />
  <link href="../stylesheets/application-65eac6ab.css" rel="stylesheet" />
  <script src="../javascripts/application-8d565278.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
</head>
<body>
  <div class="page-wrapper">
    <header>
      <h1>Joshua Paling</h1>
      <nav>
        <a class="" href="/">Blog</a>
        <a class="" href="/about.html">About</a>
        <a class="" href="/resume.html">Resume</a>
        <a href="../feed.xml">RSS</a>
        <a target="_blank" href="https://twitter.com/joshuapaling">@joshuapaling</a>
      </nav>
    </header>


<h1>Postgres</h1>

<p>psql</p>

<p><code>\q</code> to quit</p>

<p><code>\l</code> or <code>\list</code> list databases</p>

<p><code>\x</code> show results stacked row-on-row, key/value pair style, rather than one big wide table</p>

<h2 id="clone-a-database-locally">Clone a database locally</h2>

<pre><code class="language-bash">dropdb to_db_name &amp;&amp; createdb -T from_db_name to_db_name
</code></pre>

<h2 id="query-json">query json</h2>

<pre><code class="language-sql">-- nested...
select offer_response_json-&gt;'result'-&gt;&gt;'category' from items

-- or first level...
select offer_response_json-&gt;&gt;'result' from items

-- rulte: use -&gt; until the last property, then use -&gt;&gt;
</code></pre>

<h2 id="view-active-queries">View active queries</h2>

<pre><code class="language-sql">select * FROM pg_stat_activity
</code></pre>

<h2 id="dump-heroku-db">Dump heroku DB:</h2>

<pre><code class="language-markup">heroku pg:backups capture
curl -o latest.dump `heroku pg:backups public-url -a your-app-name`
</code></pre>
<p>More info <a href="https://devcenter.heroku.com/articles/heroku-postgres-import-export">here</a></p>

<p>copy heroku prod to staging:</p>

<pre><code class="language-markup">heroku pg:copy prod-svc-ee-offer-syd::DATABASE_URL DATABASE_URL --app test-svc-ee-offer-syd
</code></pre>

<h2 id="postgres-heroku-import-local-database">Postgres heroku import local database:</h2>

<p>Export your local db with:</p>

<pre><code class="language-markup">pg_dump -Fc --no-acl --no-owner -h localhost -U joshuapaling YOUR_DB_NAME &gt; YOUR_FILE_NAME.dump
</code></pre>

<p>Then, get the credentials of your postgres database with:</p>

<pre><code class="language-markup">heroku pg:credentials DATABASE_URL
# DATABASE_URL is literally just that string, as it is - don't substitute it for an actual url.
</code></pre>

<p>(You can use these credentials to connect with a GUI client if you want)</p>

<p>Then restore:</p>

<pre><code class="language-markup">pg_restore --verbose --clean --no-acl --no-owner -h HOSTNAME -U USERNAME -d DATABASE_NAME -p 5432 PATH_TO_DUMP_FILE
</code></pre>

<p>EG:</p>

<pre><code class="language-markup">pg_restore --verbose --clean --no-acl --no-owner -h ec2-11-11-111-111.compute-1.amazonaws.com -U josspaling -d abc123secret -p 5432 ../database.dump
</code></pre>

<p>More info <a href="http://stackoverflow.com/questions/11890084/importing-a-postgresql-dump-to-heroku">here</a> and <a href="https://devcenter.heroku.com/articles/heroku-postgres-import-export">here</a></p>

<h1 id="clear-stale-pid-file-when-postgres-isnt-starting-on-mac">clear stale PID file (when postgres isn't starting on mac)</h1>

<pre><code class="language-markup">cd /Volumes/Macintosh\ HD/usr/local/var/postgres/
rm -r postmaster.pid
</code></pre>

<h1 id="shortcuts-at-console">Shortcuts at console</h1>

<pre><code class="language-markup">\l
\d (display databases)
\dT+ (display enums with details)
</code></pre>


    <!-- Footer -->
    <footer>
      <nav>
        <a class="" href="/">Blog</a>
        &nbsp;&bull;&nbsp;
        <a class="" href="/about.html">About</a>
        &nbsp;&bull;&nbsp;
        <a class="" href="/resume.html">Resume</a>
        &nbsp;&bull;&nbsp;
        <a href="../feed.xml">RSS</a>
        &nbsp;&bull;&nbsp;
        <a class="" href="/archives.html">Archives</a>
      </nav>
      <div class="row">
        <div class="col-lg-12">
          <p>Copyright &copy; Joshua Paling 2015</p>
        </div>
      </div>
      <!-- /.row -->
    </footer>

  </div>

</body>
</html>

