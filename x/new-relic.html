
<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
  <title>Joshua Paling </title>
  <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />
  <link href="../stylesheets/application-4b18c387.css" rel="stylesheet" />
  <script src="../javascripts/application-8d565278.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
</head>
<body>
  <div class="page-wrapper">
    <header>
      <h1>Joshua Paling</h1>
      <nav>
        <a class="" href="/">Blog</a>
        <a class="" href="/about.html">About</a>
        <a class="" href="/resume.html">Resume</a>
        <a href="../feed.xml">RSS</a>
        <a target="_blank" href="https://twitter.com/joshuapaling">@joshuapaling</a>
      </nav>
    </header>


<h1>New Relic</h1>

<p>New Relic log search does not support regex - see <a href="https://luxgroup-hq.slack.com/archives/C01B1HZDZ7Z/p1714612806791419">slack discussion</a>
The best we can do is some basic matches like wildcard <code>*</code> and NOT with eg. <code>message:"Attempt*" -message:"Attempt 0*"</code> to find "Attempt, but not Attempt 0".</p>

<p>For number fields, use eg. <code>field:&gt;500</code></p>

<p>It's based on Lucene query language.
Query syntax for logs is <a href="https://docs.newrelic.com/docs/logs/ui-data/query-syntax-logs/">here</a>.</p>

<p>However you can do regex with RLIKE when using the Query Builder, and you can query logs with the Query Builder - <a href="https://onenr.io/0EjO9Mdy5w6">see example</a>.
So, paid users can effectively query logs via regex, using the Query Builder.</p>

<p>At LE we have log retention of 30 days.</p>

<p>We DO have New Relic logs in Big Query, and you can do regex search there.</p>

<pre><code># 50X responses in prod
 "env":"prod" responseCode:&gt;=500
</code></pre>
<p>https://onenr.io/0oR8EOEWMjG</p>

<pre><code># Anything in test that has a stack trace
app:svc-order env:test stack:"*"
</code></pre>

<hr />

<p><a href="https://one.newrelic.com/logger?account=2826932&amp;begin=1691015904712&amp;end=1691102304712&amp;state=716ef9c1-c406-5ca8-4632-e2b027c07bf9">Any deployment</a></p>

<pre><code>Search logs for "running release"
</code></pre>

<hr />

<p><a href="https://one.newrelic.com/logger?account=2826932&amp;begin=1691099406399&amp;end=1691101206399&amp;state=57a1b262-d1fe-fabb-3571-80c3c72b7ced">public offer 500 responses for a particular offer ID</a></p>

<pre><code>tag:newrelic.prod-le-svc-public-offer-syd status:500 0062y00000CPKupAAH
</code></pre>

<p>Note the 500 responses only recognise the http response, and don't have a stack trace - they're not an exception (even though an exception resulted in the 500)</p>

<hr />

<p>Errors in prod:</p>

<pre><code>env:prod level:error
</code></pre>

<hr />

<p><a href="https://one.newrelic.com/logger?account=2826932&amp;begin=1707960660000&amp;end=1707982260000&amp;state=a4a4f472-6b00-c56a-04bb-2cf474536de4">all POST requests to svc payment prod</a></p>

<pre><code>env: prod tag:"newrelic.prod-le-svc-payment-syd" pid:"router" -http_method:"OPTIONS" http_method:"POST"
</code></pre>

<p><a href="https://one.newrelic.com/logger?account=2826932&amp;begin=1707960840000&amp;end=1707982440000&amp;state=bed58ac4-1282-5607-1ab0-dcb2cedfa3c6">all POST requests that errored</a></p>

<pre><code>select max(numeric(memory_redis_bytes)) from Log where heroku_source like '%REDIS%' and team = 'flights' and env in ('prod') facet heroku_source, app limit max timeseries since  3 hour ago  COMPARE WITH 1 week ago
</code></pre>

<p><a href="https://onenr.io/0qQaPNPJVj1">Redis memory usage compared to previous week</a></p>

<pre><code>app:svc-order env:test "source":"heroku" "heroku_error_code":"H12"
</code></pre>

<p><a href="https://onenr.io/0EjOnymMbR6">Heroku error code H12</a></p>

<pre><code>SELECT average(numeric(load_avg_1m))  FROM Log WHERE app = 'svc-order' AND env = 'test' and message like '%load-avg-1m%' and message like '%postgres -%' TIMESERIES SINCE 3 day ago
</code></pre>

<p><a href="https://onenr.io/0bRmE6ylzRy">average postgres DB load</a>. load_avg_1m is a <a href="https://devcenter.heroku.com/articles/log-runtime-metrics#cpu-load-averages">heroku metric</a>, refers to dyno load.</p>

<pre><code>SELECT count(*) FROM Log WHERE `http_path_template` LIKE '%booking/departing%' SINCE 10 days ago TIMESERIES 1 day 
</code></pre>

<p><a href="https://onenr.io/0bRKzyvekwE">Find queries to the path booking/departing</a></p>


    <!-- Footer -->
    <footer>
      <nav>
        <a class="" href="/">Blog</a>
        &nbsp;&bull;&nbsp;
        <a class="" href="/about.html">About</a>
        &nbsp;&bull;&nbsp;
        <a class="" href="/resume.html">Resume</a>
        &nbsp;&bull;&nbsp;
        <a href="../feed.xml">RSS</a>
        &nbsp;&bull;&nbsp;
        <a class="" href="/archives.html">Archives</a>
      </nav>
      <div class="row">
        <div class="col-lg-12">
          <p>Copyright &copy; Joshua Paling 2015</p>
        </div>
      </div>
      <!-- /.row -->
    </footer>

  </div>

</body>
</html>

