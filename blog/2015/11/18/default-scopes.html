
<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
  <title>Joshua Paling  - Never, ever, ever user Rails default scopes</title>
  <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />
  <link href="../../../../stylesheets/application-65eac6ab.css" rel="stylesheet" />
  <script src="../../../../javascripts/application-8d565278.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
</head>
<body>
  <div class="page-wrapper">
    <header>
      <h1>Joshua Paling</h1>
      <nav>
        <a class="active" href="/">Blog</a>
        <a class="" href="/about.html">About</a>
        <a class="" href="/resume.html">Resume</a>
        <a href="../../../../feed.xml">RSS</a>
        <a target="_blank" href="https://twitter.com/joshuapaling">@joshuapaling</a>
      </nav>
    </header>


<h1>Never, ever, ever user Rails default scopes</h1>
<p>I'm <a href="http://rails-bestpractices.com/posts/2013/06/15/default_scope-is-evil/">not</a> <a href="http://www.ombulabs.com/blog/ruby/rails/best-practices/why-using-default-scope-is-a-bad-idea.html">the</a> <a href="http://stackoverflow.com/questions/25087336/why-is-using-the-rails-default-scope-often-recommend-against">first</a> <a href="http://www.railszilla.com/default_scope-in-rails-is-bad/rails">person</a> to recommend against default scopes.</p>

<p>Just wanted to throw one more warning in the pot. My previous convention was that I would ONLY use default_scope for ordering:</p>

<pre><code class="language-ruby">class Customer &lt; ActiveRecord::Base
  default_scope -&gt; { order('name ASC') }
end
</code></pre>

<p>Seems pretty harmless, right? Wrong.</p>

<p>I've spent the last few hours tracking down a bug. Turns out the cause is that when you do <code>Customer.last</code>, Rails orders by your default scope, if one exists. So, you don't get the last inserted record, you'd get (in this case) the last alphabetically ordered. You can work around it by using <code>Customer.unscoped.last</code> - but sooner or later, you will forget to do this, and it won't be fun.</p>

<p>Never, ever, ever use Rails default scopes.</p>


    <!-- Footer -->
    <footer>
      <nav>
        <a class="active" href="/">Blog</a>
        &nbsp;&bull;&nbsp;
        <a class="" href="/about.html">About</a>
        &nbsp;&bull;&nbsp;
        <a class="" href="/resume.html">Resume</a>
        &nbsp;&bull;&nbsp;
        <a href="../../../../feed.xml">RSS</a>
        &nbsp;&bull;&nbsp;
        <a class="" href="/archives.html">Archives</a>
      </nav>
      <div class="row">
        <div class="col-lg-12">
          <p>Copyright &copy; Joshua Paling 2015</p>
        </div>
      </div>
      <!-- /.row -->
    </footer>

  </div>

</body>
</html>

